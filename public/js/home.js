!function(e){var t={};function o(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/",o(o.s=1)}({1:function(e,t,o){e.exports=o("ANKz")},ANKz:function(e,t){function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}new Vue({el:"#egg",data:function(){var e=localStorage.getItem("egg-table-fixed-index");return{tableHeight:navigator.userAgent.toLowerCase().indexOf("andriod")>-1?"90vh":"97.5vh",stocks:JSON.parse(window.originalStocks)||[],tRealDate:window.tRealDate,tEstimateDate:window.tEstimateDate,dialogTitle:"",isShowEditDialog:!1,stockDetail:{cate1:"",name:"",code:"",cost:"",hold_num:""},defaultTableSort:{prop:localStorage.getItem("egg-table-sort-prop")||"",order:localStorage.getItem("egg-table-sort-order")||"ascending"},stockRules:{cate1:[{required:!0,message:"",trigger:"change"}],name:[{required:!0,message:"",trigger:"change"}],code:[{required:!0,message:"",trigger:"change"}],cost:[{required:!0,type:"number",message:"",trigger:"change"}],hold_num:[{required:!0,type:"number",message:"",trigger:"change"}]},updateUrl:"",storeUrl:window.storeUrl,searchUrl:window.searchUrl,deleteUrl:"",isUpdate:!1,isLoading:!1,suggestOptions:[],isSearching:!1,searchTimer:null,touchFixedTimer:null,lastTouchFixedTime:0,fixedIndex:e?parseInt(e):0,isImagePreview:!1,previewImage:"",isShowUploadDialog:!1,maxImageNum:10,uploadImages:[],uploadPercent:0,toUpdated:[],isShowUploadedDialog:!1,uploadedImagesInfo:[],currentInfoIndex:0,currentImageInfo:!1}},computed:{imageUploadLeft:function(){return this.maxImageNum-this.uploadImages.length},saveUploadedInfoBtnTxt:function(){switch(!0){case this.isLoading:return"处理中..";case"DELETE"===this.currentImageInfo.method:return"删除";case"PUT"===this.currentImageInfo.method:return"更新";case"POST"===this.currentImageInfo.method:return"新增";default:return"Error"}}},methods:{assignStockDetails:function(e){e=e||{},this.stockDetail={cate1:e.cate1||"",name:e.name||"",code:e.code||"",cost:e.cost||0,hold_num:e.hold_num||0}},handleSortChange:function(e){var t=e.prop,o=e.order;null===o?localStorage.removeItem("egg-table-sort-prop"):(localStorage.setItem("egg-table-sort-prop",t),localStorage.setItem("egg-table-sort-order",o))},handleCreate:function(){var e=this;!1!==this.isUpdate&&(this.assignStockDetails(),this.isUpdate=!1),this.dialogTitle="New Stock",this.isShowEditDialog=!0,this.$nextTick((function(){return e.$refs.stockDetail.clearValidate()}))},handleEdit:function(e){this.assignStockDetails(e),this.dialogTitle="Edit Stock",this.isShowEditDialog=!0,this.isUpdate=!0,this.updateUrl=e.edit},handleDelete:function(e){var t=this;this.$confirm("确认删除此持仓？","",{type:"warning"}).then((function(){t.sendRequest("delete",e).then((function(e){e&&setTimeout((function(){return location.reload()}),666)}))})).catch((function(){}))},submitForm:function(){var e=this;this.$refs.stockDetail.validate((function(t){if(!0!==t)return!1;e.isLoading=!0;var o=e.isUpdate?e.updateUrl:e.storeUrl,n=e.isUpdate?"put":"post";e.sendRequest(n,o,e.stockDetail).then((function(e){e&&setTimeout((function(){return location.reload()}),666)}))}))},sendRequest:function(e,t,n){var r=this;return axios({method:e,url:t,data:n}).then((function(e){return r.$message.success("操作成功"),!0})).catch((function(e){if(console.log(e.response),r.isLoading=!1,!e.response||422!==e.response.status||!e.response.data||"object"!==o(e.response.data.errors))return r.$message.error("操作失败："+"".concat(e.message,", Code:").concat(e.code));var t=e.response.data.errors,n=[];return Object.keys(t).forEach((function(e){n.push(t[e][0])})),r.$message.error(n.join("；")),!1}))},search:function(e){var t=this;clearTimeout(this.searchTimer),this.searchTimer=setTimeout((function(){var o={keyword:e,type:"fund"};axios.get(t.searchUrl,{params:o}).then((function(e){t.suggestOptions=e.data||[]})).catch((function(e){t.suggestOptions=[]})).then((function(){return t.isSearching=!1}))}),600)},handleSelectedStock:function(e){this.stockDetail.code=e},getSummaries:function(e){var t,o=e.columns,n=e.data,r=[],a=["estimate_ratio","real_ratio","cost_amount","profit_amount","profit_ratio"],i=0,s=0,u=0,c=0;return n.forEach((function(e){i+=Number(e.cost_amount),s+=Number(e.profit_amount),u+=Number(e.today_estimate),c+=Number(e.today_real)})),i=i.toFixed(2),s=s.toFixed(2),t=(s/i*100).toFixed(2)+"%",o.forEach((function(e,o){if(0!==o)if(-1!==a.indexOf(e.property)){var n={estimate_ratio:u.toFixed(2),real_ratio:c.toFixed(2),cost_amount:i,profit_amount:s,profit_ratio:t};r[o]=n[e.property]||""}else r[o]="";else r[o]="合计"})),r},handleFixedTouchStart:function(e){var t=this;e.preventDefault(),this.lastTouchFixedTime=(new Date).getTime(),this.touchFixedTimer=setTimeout((function(){t.touchFixedTimer=null,t.fixedIndex>=1?t.fixedIndex=0:t.fixedIndex++,localStorage.setItem("egg-table-fixed-index",t.fixedIndex)}),1e3)},handleFixedTouchEnd:function(){clearTimeout(this.touchFixedTimer),(new Date).getTime()-this.lastTouchFixedTime<1e3&&this.handleClickFixed()},handleClickFixed:function(){switch(this.fixedIndex){case 0:this.handleCreate();break;case 1:location.reload()}},withColor:function(e){return'<span class="'.concat(e>0?"t-red":e<0?"t-green":"t-grey",'">').concat(e,"</span>")},handlePreviewImage:function(e){e&&(this.previewImage=e,this.isImagePreview=!0)},previewBeforeUpload:function(e){this.handlePreviewImage(e.url)},exceedMaxUploadImage:function(){this.$message.error("单次最多可上传10张，还可以选"+this.imageUploadLeft+"张")},beforeRemoveUploadImage:function(){return this.$confirm("确认删除移除此图片？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"})},handleUploadImagesChange:function(e,t){var o=this;this.uploadImages=t.filter((function(e){return!(e.size>10485760)||(o.$message.error("已过滤超过2M的图片！"),!1)}))},startUpload:function(){var e=this;if(!(this.uploadImages.length>0))return this.$message.error("至少选择一张图片");this.isLoading=!0;var t=new FormData,o=0;if(this.uploadImages.forEach((function(e){e.raw&&(t.append("image[]",e.raw,e.name),o++)})),0===o)return this.isLoading=!1,this.$message.error("暂无可上传的图片！");var n={onUploadProgress:function(t){e.uploadPercent=(t.loaded/t.total*100).toFixed(1)}};axios.post(window.updateByImgUrl,t,n).then((function(t){var o=t.data||{};if(0!==o.code)return e.$message.error(o.msg||"图片上传功能异常");e.uploadedImagesInfo=o.data||[],e.assignUploadImageInfo(),e.isShowUploadedDialog=!0})).catch((function(t){console.error(t),e.$message.error(t.msg||"上传功能异常")})).then((function(){return e.isLoading=!1}))},assignUploadImageInfo:function(){var e=this.uploadedImagesInfo[this.currentInfoIndex]||{},t=e.data||{};t.new&&(e.cost=Number(e.data.new.cost),e.hold_num=Number(e.data.new.hold_num)),e.old=t.old||!1,e.newCate1=t.cate1,this.currentImageInfo=e},handlePageChange:function(e){var t=this;this.currentInfoIndex+=e?1:-1,this.$nextTick((function(){return t.assignUploadImageInfo()}))},saveUploaded:function(){var e=this;console.log(this.currentImageInfo),this.currentImageInfo.cate1=this.currentImageInfo.newCate1,this.$refs.uploadedInfo.validate((function(t){t&&(e.isLoading=!0,e.sendRequest(e.currentImageInfo.method,e.currentImageInfo.request,e.currentImageInfo).then((function(){return e.isLoading=!1})))}))},closeUploadedDialog:function(){if(this.currentInfoIndex==this.uploadedImagesInfo.length-1)return location.reload(),this.isShowUploadedDialog=!1;this.$confirm("还未全部确认，是否关闭？","").then((function(){return location.reload()})).catch((function(){}))}}})}});